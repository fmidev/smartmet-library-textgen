#include "tframe.h"
#include "Dictionary.h"
#include "DictionaryFactory.h"
#include "Phrase.h"

#include <iostream>
#include <stdexcept>
#include <string>

using namespace std;
using namespace boost;


namespace StoryPhrasesTest
{
  shared_ptr<TextGen::Dictionary> dict;

  void require(const string & theKey,
			   const string & theValue)
  {
	using namespace TextGen;
	Phrase p(theKey);
	const string result = p.realize(*dict);
	if(result != theValue)
	  {
		const string msg = ("'" + theKey + "'"
							+ " = '"
							+ p.realize(*dict)
							+ "' is wrong, should be '"
							+ theValue
							+ "'");
		TEST_FAILED(msg.c_str());
	  }
  }
			   

	void require(const string & theKey)
  {
	require(theKey,theKey);
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief TemperatureStory::mean() requirements
   */
  // ----------------------------------------------------------------------

  void temperature_mean()
  {
	require("keskilämpötila");
	require("astetta");

	TEST_PASSED();

  }

  // ----------------------------------------------------------------------
  /*!
   * \brief TemperatureStory::meanmax() requirements
   */
  // ----------------------------------------------------------------------

  void temperature_meanmax()
  {
	require("keskimääräinen ylin lämpötila");
	require("astetta");

	TEST_PASSED();

  }

  // ----------------------------------------------------------------------
  /*!
   * \brief TemperatureStory::meanmin() requirements
   */
  // ----------------------------------------------------------------------

  void temperature_meanmin()
  {
	require("keskimääräinen alin lämpötila");
	require("astetta");

	TEST_PASSED();

  }

  // ----------------------------------------------------------------------
  /*!
   * \brief TemperatureStory::dailymax() requirements
   */
  // ----------------------------------------------------------------------

  void temperature_dailymax()
  {
	require("päivän ylin lämpötila");
	require("on");
	require("noin");
	require("astetta");
	require("seuraavana päivänä");
	require("huomattavasti korkeampi");
	require("korkeampi");
	require("hieman korkeampi");
	require("suunnilleen sama");
	require("hieman alempi");
	require("alempi");
	require("huomattavasti alempi");

	require("1-na","maanantaina");
	require("2-na","tiistaina");
	require("3-na","keskiviikkona");
	require("4-na","torstaina");
	require("5-na","perjantaina");
	require("6-na","lauantaina");
	require("7-na","sunnuntaina");

	TEST_PASSED();
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief TemperatureStory::nightlymin() requirements
   */
  // ----------------------------------------------------------------------

  void temperature_nightlymin()
  {
	require("yön alin lämpötila");
	require("on");
	require("noin");
	require("astetta");
	require("seuraavana yönä");
	require("huomattavasti korkeampi");
	require("korkeampi");
	require("hieman korkeampi");
	require("suunnilleen sama");
	require("hieman alempi");
	require("alempi");
	require("huomattavasti alempi");

	require("1-vastaisena yönä","maanantain vastaisena yönä");
	require("2-vastaisena yönä","tiistain vastaisena yönä");
	require("3-vastaisena yönä","keskiviikon vastaisena yönä");
	require("4-vastaisena yönä","torstain vastaisena yönä");
	require("5-vastaisena yönä","perjantain vastaisena yönä");
	require("6-vastaisena yönä","lauantain vastaisena yönä");
	require("7-vastaisena yönä","sunnuntain vastaisena yönä");

	TEST_PASSED();
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief Test TemperatureStory::weekly_minmax()
   */
  // ----------------------------------------------------------------------

  void temperature_weekly_minmax()
  {
	require("päivien ylin lämpötila");
	require("öiden alin lämpötila");
	require("on");
	require("noin");
	require("astetta");

	TEST_PASSED();
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief Test TemperatureStory::weekly_averages()
   */
  // ----------------------------------------------------------------------

  void temperature_weekly_averages()
  {
	require("päivälämpötila");
	require("yölämpötila");
	require("on");
	require("noin");
	require("astetta");

	TEST_PASSED();
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief Test TemperatureStory::weekly_averages_trend()
   */
  // ----------------------------------------------------------------------

  void temperature_weekly_averages_trend()
  {
	require("päivälämpötila");
	require("yölämpötila");
	require("on");
	require("noin");
	require("astetta");
	require("aluksi");
	require("lopuksi");

	TEST_PASSED();
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief PrecipitationStory::total() requirements
   */
  // ----------------------------------------------------------------------

  void precipitation_total()
  {

	require("sadesumma");
	require("millimetriä");

	TEST_PASSED();

  }

  // ----------------------------------------------------------------------
  /*!
   * \brief PrecipitationStory::range() requirements
   */
  // ----------------------------------------------------------------------

  void precipitation_range()
  {
	require("sadesumma");
	require("yli");
	require("millimetriä");

	TEST_PASSED();

  }

  // ----------------------------------------------------------------------
  /*!
   * \brief PrecipitationStory::classification() requirements
   */
  // ----------------------------------------------------------------------

  void precipitation_classification()
  {
	require("sadesumma");
	require("paikoin");
	require("monin paikoin");
	require("yli");
	require("millimetriä");
	require("paikoin enemmän");
	require("monin paikoin enemmän");

	TEST_PASSED();

  }

  // ----------------------------------------------------------------------
  /*!
   * \brief WeatherStory::shortoverview() requirements
   */
  // ----------------------------------------------------------------------

  void weather_shortoverview()
  {
	require("enimmäkseen");
	require("selkeää");
	require("puolipilvistä");
	require("pilvistä");
	require("vaihtelevaa pilvisyyttä");
	require("poutaa");
	require("paikoin");
	require("sadetta");
	require("ajoittain sateista");
	require("sää on epävakaista");
	require("tai");
	require("räntäsadetta");
	require("lumisadetta");
	require("vesi-");
	require("lumi-");

	require("1-na","maanantaina");
	require("2-na","tiistaina");
	require("3-na","keskiviikkona");
	require("4-na","torstaina");
	require("5-na","perjantaina");
	require("6-na","lauantaina");
	require("7-na","sunnuntaina");

	TEST_PASSED();
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief FrostStory::mean() requirements
   */
  // ----------------------------------------------------------------------

  void frost_mean()
  {
	require("hallan todennäköisyys");
	require("ankaran hallan todennäköisyys");
	require("on");
	TEST_PASSED();

  }

  // ----------------------------------------------------------------------
  /*!
   * \brief FrostStory::maximum() requirements
   */
  // ----------------------------------------------------------------------

  void frost_maximum()
  {
	require("hallan todennäköisyys");
	require("ankaran hallan todennäköisyys");
	require("on");
	TEST_PASSED();
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief FrostStory::maxtwonights() requirements
   */
  // ----------------------------------------------------------------------

  void frost_maxtwonights()
  {
	require("hallan todennäköisyys");
	require("ankaran hallan todennäköisyys");
	require("on");
	require("seuraavana yönä");
	require("seuraava yö");
	require("lämpimämpi");
	require("huomattavasti lämpimämpi");

	require("1-vastaisena yönä","maanantain vastaisena yönä");
	require("2-vastaisena yönä","tiistain vastaisena yönä");
	require("3-vastaisena yönä","keskiviikon vastaisena yönä");
	require("4-vastaisena yönä","torstain vastaisena yönä");
	require("5-vastaisena yönä","perjantain vastaisena yönä");
	require("6-vastaisena yönä","lauantain vastaisena yönä");
	require("7-vastaisena yönä","sunnuntain vastaisena yönä");

	TEST_PASSED();
  }

  // ----------------------------------------------------------------------
  /*!
   * \brief RelativeHumidityStory::lowest() requirements
   */
  // ----------------------------------------------------------------------

  void relative_humidity_lowest()
  {
	require("alin suhteellinen kosteus");
	require("on");
	require("huomattavasti suurempi");
	require("suurempi");
	require("hieman suurempi");
	require("sama");
	require("hieman pienempi");
	require("pienempi");
	require("huomattavasti pienempi");

	require("1-na","maanantaina");
	require("2-na","tiistaina");
	require("3-na","keskiviikkona");
	require("4-na","torstaina");
	require("5-na","perjantaina");
	require("6-na","lauantaina");
	require("7-na","sunnuntaina");

	TEST_PASSED();
  }



  //! The actual test driver
  class tests : public tframe::tests
  {
	//! Overridden message separator
	virtual const char * const error_message_prefix() const
	{
	  return "\n\t";
	}

	//! Main test suite
	void test(void)
	{
	  TEST(temperature_mean);
	  TEST(temperature_meanmax);
	  TEST(temperature_meanmin);
	  TEST(temperature_dailymax);
	  TEST(temperature_nightlymin);
	  TEST(temperature_weekly_minmax);
	  TEST(temperature_weekly_averages);
	  TEST(temperature_weekly_averages_trend);

	  TEST(precipitation_total);
	  TEST(precipitation_range);
	  TEST(precipitation_classification);

	  TEST(weather_shortoverview);

	  TEST(frost_mean);
	  TEST(frost_maximum);
	  TEST(frost_maxtwonights);

	  TEST(relative_humidity_lowest);

	}

  }; // class tests

} // namespace StoryPhrasesTest


int main(void)
{
  cout << endl
	   << "StoryFactory requirements" << endl
	   << "==========================" << endl;

  StoryPhrasesTest::dict = TextGen::DictionaryFactory::create("mysql");
  StoryPhrasesTest::dict->init("fi");

  StoryPhrasesTest::tests t;
  return t.run();
}
